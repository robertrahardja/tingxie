<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文作业助手 - 听写与口语练习</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #5a67d8;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header p {
            color: #666;
            font-size: 1.2em;
        }
        
        .week-info {
            color: #666;
            font-size: 1.1em;
            margin-top: 10px;
        }
        
        .instructions {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .instructions h3 {
            color: #2c7a7b;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            margin-left: 20px;
            color: #2d3748;
            line-height: 1.8;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 20px 20px 0 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #666;
            background: #f7f7f7;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background: #ebebeb;
        }
        
        .tab.active {
            background: white;
            color: #5a67d8;
            border-bottom: 3px solid #5a67d8;
        }
        
        .content {
            background: white;
            border-radius: 0 0 20px 20px;
            padding: 40px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .section-title {
            color: #5a67d8;
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .icon {
            font-size: 1.5em;
        }
        
        .week-selector {
            margin-bottom: 30px;
        }
        
        .week-selector label {
            font-weight: 600;
            color: #333;
            margin-right: 10px;
        }
        
        .week-selector select {
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            font-size: 16px;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .week-selector select:focus {
            outline: none;
            border-color: #5a67d8;
        }
        
        /* New flip card styles */
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .vocab-card {
            position: relative;
            height: 200px;
            perspective: 1000px;
            cursor: pointer;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .vocab-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .card-front {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .card-back {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            transform: rotateY(180deg);
        }
        
        .vocab-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .audio-btn {
            background: rgba(255,255,255,0.3);
            border: 2px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.5em;
        }
        
        .audio-btn:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }
        
        .chinese-display {
            font-size: 3em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        
        .pinyin-display {
            font-size: 1.2em;
            color: rgba(255,255,255,0.9);
            margin-bottom: 5px;
        }
        
        .meaning-display {
            font-size: 1em;
            color: rgba(255,255,255,0.8);
        }
        
        .stroke-hint {
            font-size: 0.9em;
            position: absolute;
            bottom: 10px;
            color: rgba(255,255,255,0.8);
        }
        
        .practice-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Oral Practice Styles */
        .oral-scenario {
            background: #f7fafc;
            border-left: 5px solid #5a67d8;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
        }
        
        .scenario-title {
            color: #5a67d8;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .scenario-content {
            margin: 15px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f4f8;
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }
        
        .scenario-text {
            display: none;
            animation: fadeIn 0.5s ease-in;
            line-height: 1.8;
            text-align: left;
            width: 100%;
            font-size: 1.1em;
        }
        
        .scenario-text.visible {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .highlight {
            background: #ffd93d;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .reveal-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .reveal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .reveal-btn.hidden {
            display: none;
        }
        
        .practice-btn {
            background: #5a67d8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .practice-btn:hover {
            background: #4c51bf;
            transform: translateY(-2px);
        }
        
        .audio-recorder {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #e6f3ff;
            border-radius: 10px;
        }
        
        .record-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin: 5px;
            font-size: 1em;
        }
        
        .record-btn.recording {
            background: #38a169;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .timer {
            font-size: 3em;
            font-weight: bold;
            color: #f5576c;
            margin: 20px 0;
            text-align: center;
        }
        
        .recording-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #ff6b6b;
            color: white;
            border-radius: 20px;
            font-weight: 600;
            animation: pulse 1.5s infinite;
            margin: 0 auto;
        }
        
        .recording-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        /* Exercise section */
        .exercise-item {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .exercise-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .check-btn {
            background: #38a169;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .check-btn:hover {
            background: #2f855a;
            transform: translateY(-1px);
        }
        
        .check-btn:disabled {
            background: #48bb78;
            cursor: not-allowed;
        }
        
        /* Dictation styles */
        .practice-area {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .current-word {
            font-size: 4em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .word-info {
            font-size: 1.5em;
            color: #666;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .score-display {
            font-size: 1.2em;
            color: #666;
            margin-top: 20px;
        }
        
        .word-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .word-list h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .word-list ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .word-list li {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .word-list li:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .section-title {
                font-size: 1.5em;
            }
            
            .vocab-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .current-word {
                font-size: 3em;
            }
            
            .chinese-display {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>中文作业助手</h1>
            <p>Chinese Homework Helper</p>
            <div class="week-info" id="week-info">第1周 Week 1</div>
        </div>
        
        <div class="instructions">
            <h3>📱 使用说明 Instructions</h3>
            <ul>
                <li>词汇练习：点击喇叭按钮 🔊 听词语发音，卡片会自动翻转显示中文字词</li>
                <li>听写练习：听音频写出正确的中文词语，可重复播放</li>
                <li>口语练习：先自己练习说，然后点击"显示句子"查看参考答案</li>
                <li>黄色标记的句子需要重点练习和背诵</li>
                <li>完成练习后记得勾选综合练习项目</li>
            </ul>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('vocabulary')">📝 词汇 Vocabulary</div>
            <div class="tab" onclick="switchTab('dictation')">🎧 听写 Dictation</div>
            <div class="tab" onclick="switchTab('oral')">🎤 口语 Oral Practice</div>
            <div class="tab" onclick="switchTab('exercises')">📚 综合练习 Exercises</div>
        </div>
        
        <div class="content">
            <!-- Vocabulary Section -->
            <div id="vocabulary" class="section active">
                <h2 class="section-title">
                    <span class="icon">📝</span>
                    词汇练习 Vocabulary Practice
                </h2>
                
                <div class="week-selector">
                    <label for="week-select-vocab">选择周 Select Week:</label>
                    <select id="week-select-vocab" onchange="loadVocabulary()">
                        <option value="1">第一周 Week 1 - 基础问候</option>
                        <option value="2">第二周 Week 2 - 学校生活</option>
                        <option value="3">第三周 Week 3 - 时间表达</option>
                        <option value="4">第四周 Week 4 - 家庭成员</option>
                    </select>
                </div>
                
                <p>点击喇叭听发音，学习正确读音和写法：</p>
                <div class="vocab-grid" id="vocab-grid">
                    <!-- Vocabulary cards will be loaded here -->
                </div>
                
                <div class="practice-controls">
                    <button class="btn btn-primary" onclick="shuffleCards()">🔀 打乱顺序</button>
                    <button class="btn btn-success" onclick="flipAllCards()">👀 显示全部</button>
                    <button class="btn btn-warning" onclick="resetAllCards()">🔄 重置卡片</button>
                </div>
            </div>
            
            <!-- Dictation Section -->
            <div id="dictation" class="section">
                <h2 class="section-title">
                    <span class="icon">🎧</span>
                    听写练习 Dictation Practice
                </h2>
                
                <div class="week-selector">
                    <label for="week-select-dictation">选择周 Select Week:</label>
                    <select id="week-select-dictation" onchange="loadDictationWords()">
                        <option value="1">第一周 Week 1 - 基础问候</option>
                        <option value="2">第二周 Week 2 - 学校生活</option>
                        <option value="3">第三周 Week 3 - 时间表达</option>
                        <option value="4">第四周 Week 4 - 家庭成员</option>
                    </select>
                </div>
                
                <div class="practice-area">
                    <div class="current-word" id="current-word">
                        准备开始 Ready to Start
                    </div>
                    <div class="word-info" id="word-info"></div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    
                    <div class="practice-controls">
                        <button class="btn btn-primary" id="start-btn" onclick="startDictation()">▶️ 开始练习</button>
                        <button class="btn btn-success" id="play-btn" onclick="playCurrentWord()" disabled>🔊 重播</button>
                        <button class="btn btn-warning" id="next-btn" onclick="nextWord()" disabled>⏭️ 下一个</button>
                    </div>
                    
                    <div class="score-display" id="score-display"></div>
                </div>
                
                <div class="word-list">
                    <h3>本周词汇列表 This Week's Vocabulary</h3>
                    <ul id="word-list"></ul>
                </div>
            </div>
            
            <!-- Oral Practice Section -->
            <div id="oral" class="section">
                <h2 class="section-title">
                    <span class="icon">🎤</span>
                    口语练习 Oral Practice
                </h2>
                
                <p>先看场景标题，自己练习说句子，然后点击"显示句子"查看参考答案。<span class="highlight">黄色标记的句子要重点练习</span>：</p>
                
                <div class="oral-scenario">
                    <div class="scenario-title">场景1：自我介绍</div>
                    <div class="scenario-content">
                        <button class="reveal-btn" onclick="revealText('scenario1')">👀 显示句子</button>
                        <p class="scenario-text" id="scenario1">
                            <span class="highlight">大家好！我叫小明，今年八岁。</span>
                            我是二年级的学生。我喜欢学中文，也喜欢画画。
                            很高兴认识大家！
                        </p>
                    </div>
                    <button class="practice-btn" onclick="toggleRecorder('recorder1')">🎙️ 开始练习</button>
                    <div class="audio-recorder" id="recorder1">
                        <button class="record-btn" onclick="toggleRecording(this, 'oral1')">🔴 录音</button>
                        <button class="record-btn" onclick="playRecording('oral1')">▶️ 播放</button>
                        <button class="record-btn" onclick="saveRecording('oral1')">💾 保存</button>
                    </div>
                </div>
                
                <div class="oral-scenario">
                    <div class="scenario-title">场景2：介绍家人</div>
                    <div class="scenario-content">
                        <button class="reveal-btn" onclick="revealText('scenario2')">👀 显示句子</button>
                        <p class="scenario-text" id="scenario2">
                            <span class="highlight">我家有四口人：爸爸、妈妈、妹妹和我。</span>
                            我爸爸是老师，妈妈是医生。
                            我妹妹今年五岁，她很可爱。
                            我们一家人很幸福。
                        </p>
                    </div>
                    <button class="practice-btn" onclick="toggleRecorder('recorder2')">🎙️ 开始练习</button>
                    <div class="audio-recorder" id="recorder2">
                        <button class="record-btn" onclick="toggleRecording(this, 'oral2')">🔴 录音</button>
                        <button class="record-btn" onclick="playRecording('oral2')">▶️ 播放</button>
                        <button class="record-btn" onclick="saveRecording('oral2')">💾 保存</button>
                    </div>
                </div>
                
                <div class="oral-scenario">
                    <div class="scenario-title">场景3：谈论爱好</div>
                    <div class="scenario-content">
                        <button class="reveal-btn" onclick="revealText('scenario3')">👀 显示句子</button>
                        <p class="scenario-text" id="scenario3">
                            <span class="highlight">我有很多爱好。我最喜欢看书和画画。</span>
                            周末的时候，我经常和朋友一起踢足球。
                            我也喜欢听音乐，特别是中文歌曲。
                            这些爱好让我的生活很充实。
                        </p>
                    </div>
                    <button class="practice-btn" onclick="toggleRecorder('recorder3')">🎙️ 开始练习</button>
                    <div class="audio-recorder" id="recorder3">
                        <button class="record-btn" onclick="toggleRecording(this, 'oral3')">🔴 录音</button>
                        <button class="record-btn" onclick="playRecording('oral3')">▶️ 播放</button>
                        <button class="record-btn" onclick="saveRecording('oral3')">💾 保存</button>
                    </div>
                </div>
                
                <div class="timer" id="timer" style="display: none;">2:00</div>
                <div id="recording-indicator" class="recording-indicator" style="display: none;">
                    <div class="recording-dot"></div>
                    正在录音 Recording
                </div>
            </div>
            
            <!-- Exercises Section -->
            <div id="exercises" class="section">
                <h2 class="section-title">
                    <span class="icon">📚</span>
                    综合练习 Comprehensive Exercises
                </h2>
                
                <p>完成以下练习项目，点击"完成"按钮标记进度：</p>
                
                <div class="exercise-item">
                    <div>
                        <input type="checkbox" id="ex1">
                        <label for="ex1">完成本周课本练习（第__页）</label>
                    </div>
                    <button class="check-btn" onclick="markComplete(this, 'ex1')">✓ 完成</button>
                </div>
                
                <div class="exercise-item">
                    <div>
                        <input type="checkbox" id="ex2">
                        <label for="ex2">抄写本周生词，每个词3遍</label>
                    </div>
                    <button class="check-btn" onclick="markComplete(this, 'ex2')">✓ 完成</button>
                </div>
                
                <div class="exercise-item">
                    <div>
                        <input type="checkbox" id="ex3">
                        <label for="ex3">用本周词汇造句（至少5个句子）</label>
                    </div>
                    <button class="check-btn" onclick="markComplete(this, 'ex3')">✓ 完成</button>
                </div>
                
                <div class="exercise-item">
                    <div>
                        <input type="checkbox" id="ex4">
                        <label for="ex4">朗读课文3遍并录音</label>
                    </div>
                    <button class="check-btn" onclick="markComplete(this, 'ex4')">✓ 完成</button>
                </div>
                
                <div class="exercise-item">
                    <div>
                        <input type="checkbox" id="ex5">
                        <label for="ex5">复习上周学过的内容</label>
                    </div>
                    <button class="check-btn" onclick="markComplete(this, 'ex5')">✓ 完成</button>
                </div>
                
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-primary" onclick="generateReport()">📊 生成学习报告</button>
                    <button class="btn btn-success" onclick="saveProgress()">💾 保存进度</button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            Made with ❤️ for Chinese learners | 为中文学习者用心制作
        </div>
    </div>
    
    <script>
        // Enhanced vocabulary data structure
        const vocabularyData = {
            1: [
                { id: 1, chinese: '你好', pinyin: 'nǐ hǎo', meaning: 'Hello', audio: 'nihao.mp3' },
                { id: 2, chinese: '谢谢', pinyin: 'xiè xie', meaning: 'Thank you', audio: 'xiexie.mp3' },
                { id: 3, chinese: '再见', pinyin: 'zài jiàn', meaning: 'Goodbye', audio: 'zaijian.mp3' },
                { id: 4, chinese: '老师', pinyin: 'lǎo shī', meaning: 'Teacher', audio: 'laoshi.mp3' },
                { id: 5, chinese: '学生', pinyin: 'xué shēng', meaning: 'Student', audio: 'xuesheng.mp3' },
                { id: 6, chinese: '朋友', pinyin: 'péng yǒu', meaning: 'Friend', audio: 'pengyou.mp3' },
                { id: 7, chinese: '家人', pinyin: 'jiā rén', meaning: 'Family', audio: 'jiaren.mp3' },
                { id: 8, chinese: '中国', pinyin: 'zhōng guó', meaning: 'China', audio: 'zhongguo.mp3' },
                { id: 9, chinese: '早上好', pinyin: 'zǎo shang hǎo', meaning: 'Good morning', audio: 'zaoshanghao.mp3' },
                { id: 10, chinese: '晚安', pinyin: 'wǎn ān', meaning: 'Good night', audio: 'wanan.mp3' }
            ],
            2: [
                { id: 1, chinese: '学校', pinyin: 'xué xiào', meaning: 'School', audio: 'xuexiao.mp3' },
                { id: 2, chinese: '教室', pinyin: 'jiào shì', meaning: 'Classroom', audio: 'jiaoshi.mp3' },
                { id: 3, chinese: '书包', pinyin: 'shū bāo', meaning: 'Backpack', audio: 'shubao.mp3' },
                { id: 4, chinese: '铅笔', pinyin: 'qiān bǐ', meaning: 'Pencil', audio: 'qianbi.mp3' },
                { id: 5, chinese: '作业', pinyin: 'zuò yè', meaning: 'Homework', audio: 'zuoye.mp3' },
                { id: 6, chinese: '考试', pinyin: 'kǎo shì', meaning: 'Exam', audio: 'kaoshi.mp3' },
                { id: 7, chinese: '成绩', pinyin: 'chéng jì', meaning: 'Grades', audio: 'chengji.mp3' },
                { id: 8, chinese: '课本', pinyin: 'kè běn', meaning: 'Textbook', audio: 'keben.mp3' },
                { id: 9, chinese: '黑板', pinyin: 'hēi bǎn', meaning: 'Blackboard', audio: 'heiban.mp3' },
                { id: 10, chinese: '同学', pinyin: 'tóng xué', meaning: 'Classmate', audio: 'tongxue.mp3' }
            ],
            3: [
                { id: 1, chinese: '早上', pinyin: 'zǎo shang', meaning: 'Morning', audio: 'zaoshang.mp3' },
                { id: 2, chinese: '中午', pinyin: 'zhōng wǔ', meaning: 'Noon', audio: 'zhongwu.mp3' },
                { id: 3, chinese: '晚上', pinyin: 'wǎn shang', meaning: 'Evening', audio: 'wanshang.mp3' },
                { id: 4, chinese: '今天', pinyin: 'jīn tiān', meaning: 'Today', audio: 'jintian.mp3' },
                { id: 5, chinese: '明天', pinyin: 'míng tiān', meaning: 'Tomorrow', audio: 'mingtian.mp3' },
                { id: 6, chinese: '昨天', pinyin: 'zuó tiān', meaning: 'Yesterday', audio: 'zuotian.mp3' },
                { id: 7, chinese: '星期', pinyin: 'xīng qī', meaning: 'Week', audio: 'xingqi.mp3' },
                { id: 8, chinese: '周末', pinyin: 'zhōu mò', meaning: 'Weekend', audio: 'zhoumo.mp3' },
                { id: 9, chinese: '小时', pinyin: 'xiǎo shí', meaning: 'Hour', audio: 'xiaoshi.mp3' },
                { id: 10, chinese: '分钟', pinyin: 'fēn zhōng', meaning: 'Minute', audio: 'fenzhong.mp3' }
            ],
            4: [
                { id: 1, chinese: '爸爸', pinyin: 'bà ba', meaning: 'Father', audio: 'baba.mp3' },
                { id: 2, chinese: '妈妈', pinyin: 'mā ma', meaning: 'Mother', audio: 'mama.mp3' },
                { id: 3, chinese: '哥哥', pinyin: 'gē ge', meaning: 'Older brother', audio: 'gege.mp3' },
                { id: 4, chinese: '姐姐', pinyin: 'jiě jie', meaning: 'Older sister', audio: 'jiejie.mp3' },
                { id: 5, chinese: '弟弟', pinyin: 'dì di', meaning: 'Younger brother', audio: 'didi.mp3' },
                { id: 6, chinese: '妹妹', pinyin: 'mèi mei', meaning: 'Younger sister', audio: 'meimei.mp3' },
                { id: 7, chinese: '爷爷', pinyin: 'yé ye', meaning: 'Grandfather', audio: 'yeye.mp3' },
                { id: 8, chinese: '奶奶', pinyin: 'nǎi nai', meaning: 'Grandmother', audio: 'nainai.mp3' },
                { id: 9, chinese: '叔叔', pinyin: 'shū shu', meaning: 'Uncle', audio: 'shushu.mp3' },
                { id: 10, chinese: '阿姨', pinyin: 'ā yí', meaning: 'Aunt', audio: 'ayi.mp3' }
            ]
        };
        
        // Global variables
        let currentWeek = 1;
        let dictationWords = [];
        let currentWordIndex = 0;
        let isPlaying = false;
        let oralTimer = null;
        let oralTimeLeft = 120;
        let recordings = {};
        let mediaRecorder = null;
        let audioChunks = [];
        
        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Save current tab to localStorage
            localStorage.setItem('currentTab', tabName);
        }
        
        // Vocabulary functions
        function loadVocabulary() {
            const week = document.getElementById('week-select-vocab').value;
            const vocabGrid = document.getElementById('vocab-grid');
            const words = vocabularyData[week] || [];
            
            currentWeek = week;
            updateWeekInfo(week);
            
            vocabGrid.innerHTML = '';
            
            words.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'vocab-card';
                card.id = `vocab-card-${word.id}`;
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="vocab-number">${word.id}</div>
                            <button class="audio-btn" onclick="playAudioAndFlip('vocab-card-${word.id}', '${word.audio}')">🔊</button>
                        </div>
                        <div class="card-back" onclick="flipBack('vocab-card-${word.id}')">
                            <div class="chinese-display">${word.chinese}</div>
                            <div class="pinyin-display">${word.pinyin}</div>
                            <div class="meaning-display">${word.meaning}</div>
                            <div class="stroke-hint">点击返回 Click to flip back</div>
                        </div>
                    </div>
                `;
                vocabGrid.appendChild(card);
            });
            
            // Save current week selection
            localStorage.setItem('currentWeek', week);
        }
        
        function playAudioAndFlip(cardId, audioFile) {
            const card = document.getElementById(cardId);
            const week = document.getElementById('week-select-vocab').value;
            
            // Play audio
            const audio = new Audio(`audio/week${week}/${audioFile}`);
            audio.play().catch(e => {
                console.log('Audio file not found: ' + audioFile);
                // Show visual feedback
                const audioBtn = card.querySelector('.audio-btn');
                audioBtn.textContent = '🔊✓';
                setTimeout(() => {
                    audioBtn.textContent = '🔊';
                }, 1000);
            });
            
            // Flip card after a short delay
            setTimeout(() => {
                card.classList.add('flipped');
            }, 300);
        }
        
        function flipBack(cardId) {
            const card = document.getElementById(cardId);
            card.classList.remove('flipped');
        }
        
        function shuffleCards() {
            const vocabGrid = document.getElementById('vocab-grid');
            const cards = Array.from(vocabGrid.children);
            
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            vocabGrid.innerHTML = '';
            cards.forEach(card => vocabGrid.appendChild(card));
        }
        
        function flipAllCards() {
            document.querySelectorAll('.vocab-card').forEach(card => {
                card.classList.add('flipped');
            });
        }
        
        function resetAllCards() {
            document.querySelectorAll('.vocab-card').forEach(card => {
                card.classList.remove('flipped');
            });
        }
        
        // Dictation functions
        function loadDictationWords() {
            const week = document.getElementById('week-select-dictation').value;
            dictationWords = vocabularyData[week] || [];
            
            const wordList = document.getElementById('word-list');
            wordList.innerHTML = '';
            
            dictationWords.forEach(word => {
                const li = document.createElement('li');
                li.textContent = `${word.chinese} (${word.pinyin}) - ${word.meaning}`;
                wordList.appendChild(li);
            });
            
            resetDictation();
        }
        
        function startDictation() {
            if (dictationWords.length === 0) {
                alert('请先选择一周的词汇！ Please select a week first!');
                return;
            }
            
            currentWordIndex = 0;
            isPlaying = true;
            
            document.getElementById('start-btn').disabled = true;
            document.getElementById('play-btn').disabled = false;
            document.getElementById('next-btn').disabled = false;
            
            dictationWords = dictationWords.sort(() => Math.random() - 0.5);
            
            showCurrentWord();
            playCurrentWord();
        }
        
        function showCurrentWord() {
            const word = dictationWords[currentWordIndex];
            document.getElementById('current-word').textContent = '?';
            document.getElementById('word-info').textContent = `第 ${currentWordIndex + 1} 个 / 共 ${dictationWords.length} 个`;
            
            updateProgress();
        }
        
        function playCurrentWord() {
            const word = dictationWords[currentWordIndex];
            const week = document.getElementById('week-select-dictation').value;
            
            const audio = new Audio(`audio/week${week}/${word.audio}`);
            audio.play().catch(e => {
                console.log('Audio file not found');
                alert(`播放词语: ${word.pinyin}`);
            });
        }
        
        function nextWord() {
            const word = dictationWords[currentWordIndex];
            document.getElementById('current-word').textContent = word.chinese;
            
            setTimeout(() => {
                currentWordIndex++;
                
                if (currentWordIndex >= dictationWords.length) {
                    endDictation();
                } else {
                    showCurrentWord();
                    playCurrentWord();
                }
            }, 2000);
        }
        
        function updateProgress() {
            const progress = (currentWordIndex / dictationWords.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }
        
        function endDictation() {
            isPlaying = false;
            document.getElementById('current-word').textContent = '练习完成！Well done!';
            document.getElementById('word-info').textContent = '';
            document.getElementById('score-display').textContent = `你完成了 ${dictationWords.length} 个词的听写练习！`;
            
            document.getElementById('start-btn').disabled = false;
            document.getElementById('play-btn').disabled = true;
            document.getElementById('next-btn').disabled = true;
            
            // Save completion to localStorage
            const completions = JSON.parse(localStorage.getItem('dictationCompletions') || '{}');
            const week = document.getElementById('week-select-dictation').value;
            completions[`week${week}`] = new Date().toISOString();
            localStorage.setItem('dictationCompletions', JSON.stringify(completions));
        }
        
        function resetDictation() {
            isPlaying = false;
            currentWordIndex = 0;
            document.getElementById('current-word').textContent = '准备开始 Ready to Start';
            document.getElementById('word-info').textContent = '';
            document.getElementById('score-display').textContent = '';
            document.getElementById('progress-fill').style.width = '0%';
            
            document.getElementById('start-btn').disabled = false;
            document.getElementById('play-btn').disabled = true;
            document.getElementById('next-btn').disabled = true;
        }
        
        // Oral Practice functions
        function revealText(scenarioId) {
            const text = document.getElementById(scenarioId);
            const btn = text.parentElement.querySelector('.reveal-btn');
            
            text.classList.add('visible');
            btn.classList.add('hidden');
        }
        
        function toggleRecorder(recorderId) {
            const recorder = document.getElementById(recorderId);
            recorder.style.display = recorder.style.display === 'none' ? 'block' : 'none';
        }
        
        async function toggleRecording(btn, recordingId) {
            if (!btn.classList.contains('recording')) {
                // Start recording
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        recordings[recordingId] = audioUrl;
                    };
                    
                    mediaRecorder.start();
                    btn.classList.add('recording');
                    btn.textContent = '⏹️ 停止';
                    
                    // Show recording indicator
                    document.getElementById('recording-indicator').style.display = 'inline-flex';
                    
                    // Start timer
                    startOralTimer();
                } catch (err) {
                    alert('请允许使用麦克风进行录音 Please allow microphone access');
                }
            } else {
                // Stop recording
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                btn.classList.remove('recording');
                btn.textContent = '🔴 录音';
                
                // Hide recording indicator
                document.getElementById('recording-indicator').style.display = 'none';
                
                // Stop timer
                stopOralTimer();
            }
        }
        
        function playRecording(recordingId) {
            const audioUrl = recordings[recordingId];
            if (audioUrl) {
                const audio = new Audio(audioUrl);
                audio.play();
            } else {
                alert('还没有录音 No recording yet');
            }
        }
        
        function saveRecording(recordingId) {
            const audioUrl = recordings[recordingId];
            if (audioUrl) {
                // Save to localStorage
                const savedRecordings = JSON.parse(localStorage.getItem('oralRecordings') || '{}');
                savedRecordings[recordingId] = {
                    date: new Date().toISOString(),
                    week: currentWeek
                };
                localStorage.setItem('oralRecordings', JSON.stringify(savedRecordings));
                
                alert('录音已保存！Recording saved!');
            } else {
                alert('没有录音可保存 No recording to save');
            }
        }
        
        function startOralTimer() {
            const timerDiv = document.getElementById('timer');
            timerDiv.style.display = 'block';
            oralTimeLeft = 120;
            updateTimer();
            
            oralTimer = setInterval(() => {
                oralTimeLeft--;
                updateTimer();
                
                if (oralTimeLeft <= 0) {
                    // Auto stop recording
                    document.querySelectorAll('.record-btn.recording').forEach(btn => {
                        btn.click();
                    });
                }
            }, 1000);
        }
        
        function stopOralTimer() {
            clearInterval(oralTimer);
            document.getElementById('timer').style.display = 'none';
        }
        
        function updateTimer() {
            const minutes = Math.floor(oralTimeLeft / 60);
            const seconds = oralTimeLeft % 60;
            document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Exercise functions
        function markComplete(btn, exerciseId) {
            btn.style.background = '#48bb78';
            btn.textContent = '✓ 已完成';
            btn.disabled = true;
            
            const checkbox = btn.parentElement.parentElement.querySelector('input[type="checkbox"]');
            checkbox.checked = true;
            
            // Save progress
            const progress = JSON.parse(localStorage.getItem('exerciseProgress') || '{}');
            progress[exerciseId] = {
                completed: true,
                date: new Date().toISOString(),
                week: currentWeek
            };
            localStorage.setItem('exerciseProgress', JSON.stringify(progress));
            
            // Play completion sound
            playCompletionSound();
        }
        
        function playCompletionSound() {
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE');
            audio.volume = 0.2;
            audio.play();
        }
        
        function generateReport() {
            const progress = JSON.parse(localStorage.getItem('exerciseProgress') || '{}');
            const dictationCompletions = JSON.parse(localStorage.getItem('dictationCompletions') || '{}');
            const oralRecordings = JSON.parse(localStorage.getItem('oralRecordings') || '{}');
            
            let report = '📊 学习报告 Learning Report\n\n';
            report += `当前周: 第${currentWeek}周\n\n`;
            
            // Exercise completion
            const exerciseCount = Object.keys(progress).filter(key => progress[key].completed).length;
            report += `✅ 综合练习完成: ${exerciseCount}/5\n`;
            
            // Dictation completion
            const dictationCount = Object.keys(dictationCompletions).length;
            report += `🎧 听写练习完成: ${dictationCount} 周\n`;
            
            // Oral recordings
            const oralCount = Object.keys(oralRecordings).length;
            report += `🎤 口语录音: ${oralCount} 个\n\n`;
            
            report += '继续加油！Keep up the good work! 💪';
            
            alert(report);
        }
        
        function saveProgress() {
            const progressData = {
                currentWeek: currentWeek,
                currentTab: document.querySelector('.tab.active').textContent,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('progressData', JSON.stringify(progressData));
            alert('进度已保存！Progress saved! ✅');
        }
        
        function updateWeekInfo(week) {
            const weekInfo = document.getElementById('week-info');
            const weekNames = {
                1: '第1周 Week 1 - 基础问候',
                2: '第2周 Week 2 - 学校生活',
                3: '第3周 Week 3 - 时间表达',
                4: '第4周 Week 4 - 家庭成员'
            };
            weekInfo.textContent = weekNames[week] || `第${week}周 Week ${week}`;
        }
        
        // Load saved progress on page load
        function loadSavedProgress() {
            // Load exercise progress
            const progress = JSON.parse(localStorage.getItem('exerciseProgress') || '{}');
            Object.keys(progress).forEach(exerciseId => {
                if (progress[exerciseId].completed) {
                    const checkbox = document.getElementById(exerciseId);
                    if (checkbox) {
                        checkbox.checked = true;
                        const btn = checkbox.parentElement.parentElement.querySelector('.check-btn');
                        if (btn) {
                            btn.style.background = '#48bb78';
                            btn.textContent = '✓ 已完成';
                            btn.disabled = true;
                        }
                    }
                }
            });
            
            // Load saved week
            const savedWeek = localStorage.getItem('currentWeek') || '1';
            document.getElementById('week-select-vocab').value = savedWeek;
            document.getElementById('week-select-dictation').value = savedWeek;
            
            // Load saved tab
            const savedTab = localStorage.getItem('currentTab');
            if (savedTab) {
                document.querySelector(`[onclick="switchTab('${savedTab}')"]`).click();
            }
        }
        
        // Initialize
        window.onload = function() {
            loadVocabulary();
            loadDictationWords();
            loadSavedProgress();
            
            console.log('中文作业助手已准备就绪！Chinese Homework Helper is ready!');
        };
    </script>
</body>
</html>