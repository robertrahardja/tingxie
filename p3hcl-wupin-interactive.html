<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»‹ç»æˆ‘çš„ç‰©å“ - P3HCL äº’åŠ¨é˜…è¯»</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: #f5f5f5;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .lesson-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .lesson-header h1 {
            font-size: 32px;
            margin: 0 0 10px 0;
        }

        .lesson-header .subtitle {
            font-size: 18px;
            opacity: 0.9;
        }

        .content-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .reading-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .reading-title {
            font-size: 36px;
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }

        .reading-paragraph {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            line-height: 2.2;
            font-size: 22px;
            margin-bottom: 20px;
            color: #333;
            text-indent: 2em;
        }

        .reading-paragraph:last-child {
            margin-bottom: 0;
        }

        /* Interactive word styling */
        .word-interactive {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            position: relative;
            display: inline-block;
        }

        .word-interactive:hover {
            background: #e3f2fd;
            color: #1976d2;
        }

        .word-interactive.selected {
            background: #667eea;
            color: white;
        }

        /* Popup tooltip */
        .word-tooltip {
            position: fixed;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 280px;
            max-width: 400px;
            display: none;
            border: 2px solid #667eea;
        }

        .word-tooltip.show {
            display: block;
        }

        .tooltip-word {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .tooltip-pinyin {
            font-size: 20px;
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
            font-style: italic;
        }

        .tooltip-english {
            font-size: 18px;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }

        .tooltip-audio-btn {
            width: 100%;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-size: 18px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .tooltip-audio-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .tooltip-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .tooltip-close:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        /* Instruction banner */
        .instruction-banner {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .instruction-banner p {
            margin: 0;
            color: #1565c0;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .lesson-header h1 {
                font-size: 24px;
            }

            .reading-title {
                font-size: 28px;
            }

            .reading-paragraph {
                font-size: 20px;
                padding: 20px;
                line-height: 2;
            }

            .word-tooltip {
                min-width: 250px;
                max-width: 90vw;
            }

            .tooltip-word {
                font-size: 28px;
            }

            .tooltip-pinyin {
                font-size: 18px;
            }

            .tooltip-english {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <nav class="main-nav">
        <div class="nav-container">
            <button class="menu-toggle" id="menu-toggle">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </button>
            <div class="nav-menu" id="nav-menu">
                <a href="index.html" class="nav-item">æœ€æ–°è¯è¯­</a>
                <a href="review.html" class="nav-item">å¤ä¹ è¯è¯­</a>
                <a href="vocabulary.html" class="nav-item">è¯æ±‡æµè§ˆ</a>
                <a href="phrase-matching.html" class="nav-item">è¯è¯­æ­é…</a>
                <a href="handwriting.html" class="nav-item">ç¬”ç”»ç»ƒä¹ </a>
                <a href="radicals.html" class="nav-item">éƒ¨é¦–å­¦ä¹ </a>
                <a href="family.html" class="nav-item">å®¶åº­ç§°å‘¼</a>
                <a href="instructions.html" class="nav-item">æŒ‡ç¤ºè¯æ±‡</a>
                <a href="p3hcl-reading-sync.html" class="nav-item">é˜…è¯»ç»ƒä¹ </a>
                <a href="p3hcl-wupin-interactive.html" class="nav-item active">äº’åŠ¨é˜…è¯»</a>
                <a href="dashboard.html" class="nav-item">å®¶é•¿çœ‹æ¿</a>
                <a href="settings.html" class="nav-item">è®¾ç½®</a>
            </div>
        </div>
    </nav>

    <div class="lesson-header">
        <h1>ğŸ“ ä»‹ç»æˆ‘çš„ç‰©å“ (äº’åŠ¨é˜…è¯»)</h1>
        <div class="subtitle">P3HCL Interactive Reading - Click words to learn!</div>
    </div>

    <div class="content-container">
        <div class="instruction-banner">
            <p>ğŸ’¡ ç‚¹å‡»ä»»ä½•è¯è¯­æŸ¥çœ‹æ‹¼éŸ³ã€è‹±æ–‡ç¿»è¯‘å’Œå‘éŸ³ | Click any word to see pinyin, English translation, and audio</p>
        </div>

        <div class="reading-container">
            <div class="reading-title">ã€Šä»‹ç»æˆ‘çš„ç‰©å“ã€‹</div>
            <div id="reading-content" class="reading-content">
                <!-- Content will be loaded via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Tooltip popup -->
    <div id="word-tooltip" class="word-tooltip">
        <button class="tooltip-close" onclick="closeTooltip()">Ã—</button>
        <div class="tooltip-word" id="tooltip-word"></div>
        <div class="tooltip-pinyin" id="tooltip-pinyin"></div>
        <div class="tooltip-english" id="tooltip-english"></div>
        <button class="tooltip-audio-btn" onclick="playTooltipAudio()">
            <span>ğŸ”Š</span>
            <span>æ’­æ”¾å‘éŸ³</span>
        </button>
    </div>

    <audio id="word-audio" style="display: none;"></audio>

    <script>
        // Text content organized by paragraphs
        const paragraphs = [
            'æˆ‘çš„æ°´å£¶æ˜¯è“è‰²çš„ï¼Œå®ƒæ˜¯åœ†æŸ±å½¢çš„ï¼Œä¸Šé¢ç”»ç€æ¼‚äº®çš„å†°é›ªå¥³ç‹ã€‚æ°´å£¶çš„æ—è¾¹æœ‰ä¸€æ¡ç»†é•¿çš„å¸¦å­ã€‚ä¸€æŒ‰æŒ‰é’®ï¼Œç›–å­å°±ä¼šå¼¹å¼€ã€‚ä¸€æ‰“å¼€ç›–å­ï¼Œå¸ç®¡å°±ä¼šå¼¹èµ·æ¥ã€‚æ°´å£¶æ˜¯æˆ‘çš„å¥½ä¼™ä¼´ï¼Œæˆ‘å¤©å¤©éƒ½å¸¦ç€å®ƒä¸Šå­¦ã€‚',
            'æˆ‘çš„æ–‡å…·ç›’æ˜¯é•¿æ–¹å½¢çš„ï¼Œä¸Šé¢ç”»ç€ä¸€è¾†è½¦ã€‚æ–‡å…·ç›’çš„é‡Œé¢è£…ç€å„ç§å„æ ·çš„æ–‡å…·ï¼Œæœ‰é“…ç¬”ã€å°ºå­ã€æ©¡çš®ã€è¿˜æœ‰å·ç¬”åˆ€ç­‰ã€‚æ–‡å…·ç›’æ˜¯æˆ‘å­¦ä¹ çš„å¥½ä¼™ä¼´ï¼Œæˆ‘å¤©å¤©éƒ½å¸¦ç€å®ƒä¸Šå­¦ã€‚',
            'æˆ‘çš„é—¹é’Ÿæ˜¯é»„è‰²çš„ï¼Œå®ƒæ˜¯åœ†å½¢çš„ï¼Œä¸Šé¢è¿˜"é•¿"ç€ä¸¤ä¸ªå¯çˆ±çš„"è€³æœµ"ã€‚é—¹é’Ÿçš„é‡Œé¢ç”»ç€ä¸€åªç±³è€é¼ ï¼Œåªè¦é—¹é’Ÿä¸€å“èµ·ï¼Œæˆ‘å°±ä¼šæŒ‰æ‰èµ·åºŠå»ä¸Šè¯¾ã€‚å®ƒæ¯å¤©æ—©ä¸Šéƒ½ä¼šå‡†æ—¶å«æˆ‘èµ·åºŠï¼Œæ˜¯æˆ‘ç”Ÿæ´»ä¸­ç¦»ä¸å¼€çš„å¥½æœ‹å‹ã€‚',
            'æˆ‘çš„ä¹¦åŒ…æ˜¯é»‘è‰²çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–°å‹çš„ä¹¦åŒ…ï¼Œä¸Šé¢ç”»ç€ä¸€ä¸ªè™è ä¾ ã€‚è¿™ä¸ªä¹¦åŒ…æœ‰å¾ˆå¤šéš”å±‚ï¼Œå…¶ä¸­ä¸€ä¸ªå¤§ç‚¹çš„å¯ä»¥è£…ä¹¦ï¼Œä¸­é—´çš„è£…æœ¬å­ï¼Œå°ç‚¹çš„è£…æ–‡å…·ä¹‹ç±»çš„ï¼Œä¸¤è¾¹çš„ç½‘åŒ…å¯ä»¥æ”¾æ°´å£¶æˆ–è€…å…¶å®ƒæ‚è¥¿ã€‚è¿™ä¸ªä¹¦åŒ…çš„èƒŒå¸¦å¾ˆå®½ï¼Œå†åŠ ä¸Šæµ·ç»µå«ï¼ŒèƒŒèµ·æ¥å¾ˆèˆ’æœï¼Œè¿˜å¯ä»¥æŠŠä¹¦åŒ…ç»‘åœ¨è…°ä¸Šï¼Œè¿™æ ·è·‘èµ·æ¥çš„æ—¶å€™ï¼Œä¹¦åŒ…å°±ä¸ä¼šå·¦å³æ™ƒåŠ¨ã€‚å®ƒæ¯å¤©æ—©ä¸Šé™ªæˆ‘ä¸Šå­¦ï¼Œä¸‹åˆä¼´æˆ‘å›å®¶ï¼ŒçœŸæ˜¯æˆ‘å­¦ä¹ ä¸Šçš„å¥½å¸®æ‰‹ã€‚',
            'æˆ‘çš„æ‰‹è¡¨æ˜¯ç²‰çº¢è‰²çš„ï¼Œå®ƒæ˜¯çˆ±å¿ƒå½¢çš„æ‰‹è¡¨ï¼å®ƒè¿˜æœ‰ä¸€ä¸ªè¡¨ç›–ï¼Œä¸Šé¢ç”»ç€ä¸€åªè´è¶çš„å›¾æ¡ˆã€‚è¡¨ç›–æ—è¾¹æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œä¸€æŒ‰æŒ‰é’®ï¼Œè¡¨ç›–å°±ä¼šæ‰“å¼€ï¼Œæˆ‘å°±èƒ½çœ‹åˆ°æ—¶é—´ã€‚è‡ªä»æœ‰äº†è¿™åªæ‰‹è¡¨ï¼Œæˆ‘æ¯å¤©æ—©ç¡æ—©èµ·ï¼Œå‡†æ—¶ä¸Šå­¦ã€‚è¿™åªæ‰‹è¡¨å¤©å¤©é™ªä¼´æˆ‘ï¼ŒçœŸæ˜¯æˆ‘çš„å¥½ä¼™ä¼´ã€‚'
        ];

        let vocabularyData = [];
        let currentAudioWord = '';

        // Load vocabulary data
        async function loadVocabulary() {
            try {
                const response = await fetch('data/p3hcl-wupin-vocabulary.json');
                const data = await response.json();
                vocabularyData = data.vocabulary;
                renderContent();
            } catch (error) {
                console.error('Error loading vocabulary:', error);
                renderFallbackContent();
            }
        }

        // Create a map for quick vocabulary lookup
        function createVocabMap() {
            const vocabMap = new Map();
            vocabularyData.forEach(item => {
                vocabMap.set(item.simplified, item);
                if (item.traditional !== item.simplified) {
                    vocabMap.set(item.traditional, item);
                }
            });
            return vocabMap;
        }

        // Segment text into words/phrases based on vocabulary
        function segmentText(text, vocabMap) {
            const segments = [];
            let i = 0;

            while (i < text.length) {
                let matched = false;

                // Try to match longest possible phrase (up to 5 characters)
                for (let len = 5; len >= 1; len--) {
                    const substring = text.substring(i, i + len);
                    if (vocabMap.has(substring)) {
                        segments.push({
                            text: substring,
                            vocab: vocabMap.get(substring),
                            isWord: true
                        });
                        i += len;
                        matched = true;
                        break;
                    }
                }

                // If no match, add as regular character
                if (!matched) {
                    segments.push({
                        text: text[i],
                        isWord: false
                    });
                    i++;
                }
            }

            return segments;
        }

        // Render content with interactive words
        function renderContent() {
            const vocabMap = createVocabMap();
            const content = document.getElementById('reading-content');
            let html = '';

            paragraphs.forEach((para, paraIndex) => {
                html += '<div class="reading-paragraph">';

                const segments = segmentText(para, vocabMap);
                segments.forEach((segment, segIndex) => {
                    if (segment.isWord) {
                        const vocab = segment.vocab;
                        html += `<span class="word-interactive" data-simplified="${vocab.simplified}" data-traditional="${vocab.traditional}" data-pinyin="${vocab.pinyin}" data-english="${vocab.english}" onclick="showTooltip(this, event)">${segment.text}</span>`;
                    } else {
                        html += segment.text;
                    }
                });

                html += '</div>';
            });

            content.innerHTML = html;
        }

        // Render fallback content if vocabulary fails to load
        function renderFallbackContent() {
            const content = document.getElementById('reading-content');
            let html = '';
            paragraphs.forEach(para => {
                html += `<div class="reading-paragraph">${para}</div>`;
            });
            content.innerHTML = html;
        }

        // Show tooltip when word is clicked
        function showTooltip(element, event) {
            event.stopPropagation();

            // Remove selected class from all words
            document.querySelectorAll('.word-interactive').forEach(el => {
                el.classList.remove('selected');
            });

            // Add selected class to clicked word
            element.classList.add('selected');

            const tooltip = document.getElementById('word-tooltip');
            const simplified = element.dataset.simplified;
            const traditional = element.dataset.traditional;
            const pinyin = element.dataset.pinyin;
            const english = element.dataset.english;

            // Update tooltip content
            document.getElementById('tooltip-word').textContent = traditional;
            document.getElementById('tooltip-pinyin').textContent = pinyin;
            document.getElementById('tooltip-english').textContent = english;

            // Store current word for audio
            currentAudioWord = simplified;

            // Position tooltip near the clicked word
            const rect = element.getBoundingClientRect();
            const tooltipWidth = 300;
            const tooltipHeight = 250;

            let left = rect.left + (rect.width / 2) - (tooltipWidth / 2);
            let top = rect.bottom + 10;

            // Adjust if tooltip goes off screen
            if (left < 10) left = 10;
            if (left + tooltipWidth > window.innerWidth - 10) {
                left = window.innerWidth - tooltipWidth - 10;
            }

            // If tooltip would go below viewport, show above word
            if (top + tooltipHeight > window.innerHeight - 10) {
                top = rect.top - tooltipHeight - 10;
            }

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.classList.add('show');
        }

        // Close tooltip
        function closeTooltip() {
            const tooltip = document.getElementById('word-tooltip');
            tooltip.classList.remove('show');

            // Remove selected class from all words
            document.querySelectorAll('.word-interactive').forEach(el => {
                el.classList.remove('selected');
            });
        }

        // Play audio for the word in tooltip
        function playTooltipAudio() {
            if (!currentAudioWord) return;

            const audio = document.getElementById('word-audio');
            const audioPath = `audio/p3hcl-wupin/${currentAudioWord}.mp3`;

            audio.src = audioPath;
            audio.play().catch(error => {
                console.error('Error playing audio:', error);
                alert('éŸ³é¢‘æ–‡ä»¶æœªæ‰¾åˆ° | Audio file not found');
            });
        }

        // Close tooltip when clicking outside
        document.addEventListener('click', function(e) {
            const tooltip = document.getElementById('word-tooltip');
            if (!tooltip.contains(e.target) && !e.target.classList.contains('word-interactive')) {
                closeTooltip();
            }
        });

        // Mobile navigation
        document.getElementById('menu-toggle').addEventListener('click', function() {
            document.getElementById('nav-menu').classList.toggle('active');
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            const menuToggle = document.getElementById('menu-toggle');
            const navMenu = document.getElementById('nav-menu');

            if (!menuToggle.contains(e.target) && !navMenu.contains(e.target)) {
                navMenu.classList.remove('active');
            }
        });

        // Initialize
        loadVocabulary();
    </script>
</body>
</html>
